<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§  BrainRot Admin</title>
<style>
body{font-family:'Poppins',sans-serif;background:radial-gradient(circle at top left,#000428,#004e92);color:white;margin:0;padding:20px;text-align:center;}
h1{font-family:'Orbitron',sans-serif;font-size:3em;margin-top:20px;text-shadow:0 0 20px #00c6ff;}
.box{background:rgba(255,255,255,0.1);padding:20px;border-radius:20px;margin:20px auto;max-width:900px;text-align:center;box-shadow:0 0 40px rgba(0,198,255,0.3);}
button{margin:5px;padding:10px 18px;border:none;border-radius:10px;background:linear-gradient(90deg,#00c6ff,#0072ff);color:white;font-weight:600;cursor:pointer;}
button:hover{transform:scale(1.05);}
.trade-list{margin-top:20px;text-align:left;background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;max-height:400px;overflow-y:auto;}
.trade-item{border-bottom:1px solid rgba(255,255,255,0.2);padding:10px 0;}
.trade-item:last-child{border:none;}
#chatBox{margin-top:20px;text-align:left;background:rgba(255,255,255,0.1);padding:15px;border-radius:10px;max-height:300px;overflow-y:auto;}
.message{padding:5px 10px;border-bottom:1px solid rgba(255,255,255,0.2);}
input{padding:10px;border-radius:10px;border:none;width:70%;margin:5px 0;}
</style>
</head>
<body>
<h1>ğŸ§  BrainRot Admin</h1>

<div class="box">
<h2>ğŸ“© Trade-Anfragen</h2>
<div id="tradeList" class="trade-list">ğŸ”„ Lade Anfragen...</div>
</div>

<div class="box" id="chatSection" style="display:none;">
<h2>ğŸ’¬ Chat mit User</h2>
<div id="chatBox">ğŸ”„ WÃ¤hle zuerst eine angenommene Anfrage</div>
<input type="text" id="chatInput" placeholder="Nachricht eingeben">
<button id="sendChatBtn">Senden</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyC1kLr0wdCM1HDWj8x7LvMV2Q0K6kzycUY",
authDomain:"brainrottradingseite.firebaseapp.com",
projectId:"brainrottradingseite",
storageBucket:"brainrottradingseite.firebasestorage.app",
messagingSenderId:"212738351089",
appId:"1:212738351089:web:9ae5b737cf550554d16e50",
measurementId:"G-BNZ0Y47M0K",
databaseURL:"https://brainrottradingseite-default-rtdb.europe-west1.firebasedatabase.app/"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const tradeList = document.getElementById("tradeList");
const chatSection = document.getElementById("chatSection");
const chatBox = document.getElementById("chatBox");
const chatInput = document.getElementById("chatInput");
const sendChatBtn = document.getElementById("sendChatBtn");

let activeChatRef = null;
let lastSent = 0;
const cooldown = 5000;

// ----------------- Trade-Anfragen anzeigen -----------------
const tradesRef = ref(db,"trades");
onValue(tradesRef, snapshot=>{
  const trades = snapshot.val();
  tradeList.innerHTML="";
  if(!trades){ tradeList.innerHTML="ğŸ˜´ Keine Anfragen"; return; }

  Object.entries(trades).forEach(([key,t])=>{
    const div = document.createElement("div");
    div.className="trade-item";
    div.innerHTML=`
      <p>ğŸ§  Brainrot: ${t.brainrotName || "â€”"}</p>
      <p>ğŸ‘¤ ${t.robloxName}</p>
      <p>ğŸ“¨ Angebot: ${t.offer}</p>
      <p>âœ… Status: ${t.accepted ? "Akzeptiert" : "Offen"}</p>
    `;

    if(!t.accepted){
      const acceptBtn = document.createElement("button");
      acceptBtn.textContent="Annehmen";
      acceptBtn.onclick=()=>set(ref(db,"trades/"+key+"/accepted"),true);
      div.appendChild(acceptBtn);
    }

    if(t.accepted){
      const chatBtn = document.createElement("button");
      chatBtn.textContent="Chat starten";
      chatBtn.onclick=()=>{
        activeChatRef = ref(db,"chats/"+key);
        chatSection.style.display="block";
        loadChat();
      };
      div.appendChild(chatBtn);
    }

    tradeList.appendChild(div);
  });
});

// ----------------- Chat laden -----------------
function loadChat(){
  if(!activeChatRef) return;
  onValue(activeChatRef, snapshot=>{
    const data = snapshot.val();
    chatBox.innerHTML="";
    if(!data) chatBox.textContent="ğŸ’¬ Noch keine Nachrichten";
    else Object.values(data).sort((a,b)=>a.time-b.time).forEach(msg=>{
      const div=document.createElement("div");
      div.className="message";
      div.textContent=`${msg.user}: ${msg.text}`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

// ----------------- Nachricht senden -----------------
sendChatBtn.addEventListener("click", async()=>{
  if(!activeChatRef){ alert("âš ï¸ WÃ¤hle zuerst eine angenommene Anfrage!"); return; }
  const text = chatInput.value.trim();
  if(!text) return;
  const now = Date.now();
  if(now - lastSent < cooldown) return alert("âš ï¸ Warte ein paar Sekunden!");
  lastSent = now;
  const newRef = push(activeChatRef);
  await set(newRef,{user:"Admin", text, time:now});
  chatInput.value="";
});
</script>
</body>
</html>