<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§  BrainRot Trading & Chat</title>
<style>
body { font-family:'Poppins',sans-serif; background: radial-gradient(circle at top left,#000428,#004e92); color:white; margin:0; padding:20px; text-align:center;}
h1 { font-family:'Orbitron',sans-serif; font-size:3em; margin-top:20px; text-shadow:0 0 20px #00c6ff;}
.box { background: rgba(255,255,255,0.1); padding:20px; border-radius:20px; margin:20px auto; max-width:900px; text-align:center; box-shadow:0 0 40px rgba(0,198,255,0.3);}
input, select { padding:10px; border-radius:10px; border:none; width:70%; margin:5px 0;}
button { margin-top:10px; padding:10px 18px; border:none; border-radius:10px; background:linear-gradient(90deg,#00c6ff,#0072ff); color:white; font-weight:600; cursor:pointer;}
button:hover { transform:scale(1.05); }
.brainrot-container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
.brainrot-card { background: rgba(255,255,255,0.1); border-radius:20px; padding:15px; width:220px; text-align:center; box-shadow:0 0 30px rgba(0,198,255,0.2);}
#chatBox { max-height:300px; overflow-y:auto; margin-bottom:10px; text-align:left; background:rgba(255,255,255,0.1); padding:10px; border-radius:10px;}
.message { padding:5px 10px; border-bottom:1px solid rgba(255,255,255,0.2);}
</style>
</head>
<body>
<h1>ğŸ§  BrainRot Trading</h1>

<!-- Brainrots anzeigen -->
<div class="box">
<h2>ğŸ§  VerfÃ¼gbare Brainrots</h2>
<div class="brainrot-container" id="brainrotContainer"><p>ğŸ”„ Lade Brainrots...</p></div>
</div>

<!-- Trade-ID Anzeige -->
<div class="box">
<h2>ğŸ“¨ Trade-ID</h2>
<p id="tradeIdDisplay">Noch keine Anfrage gesendet</p>
</div>

<!-- Chat -->
<div class="box">
<h2>ğŸ’¬ Chat mit Admin</h2>
<input type="text" id="tradeIdInput" placeholder="Gib deine Trade-ID ein"><br>
<button id="loginChatBtn">Chat starten</button>
<div id="chatBox">Chat nur aktiv, wenn Admin die Anfrage angenommen hat.</div>
<input type="text" id="chatInput" placeholder="Nachricht eingeben">
<button id="sendChatBtn">Senden</button>
<p id="chatInfo"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyC1kLr0wdCM1HDWj8x7LvMV2Q0K6kzycUY",
authDomain:"brainrottradingseite.firebaseapp.com",
projectId:"brainrottradingseite",
storageBucket:"brainrottradingseite.firebasestorage.app",
messagingSenderId:"212738351089",
appId:"1:212738351089:web:9ae5b737cf550554d16e50",
measurementId:"G-BNZ0Y47M0K",
databaseURL:"https://brainrottradingseite-default-rtdb.europe-west1.firebasedatabase.app/"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// User-ID speichern
let userId = localStorage.getItem("userId");
if(!userId){ userId="user-"+Math.floor(Math.random()*100000); localStorage.setItem("userId",userId); }

const brainrotContainer = document.getElementById("brainrotContainer");
const tradeIdDisplay = document.getElementById("tradeIdDisplay");
const tradeIdInput = document.getElementById("tradeIdInput");
const loginChatBtn = document.getElementById("loginChatBtn");
const chatBox = document.getElementById("chatBox");
const chatInput = document.getElementById("chatInput");
const sendChatBtn = document.getElementById("sendChatBtn");
const chatInfo = document.getElementById("chatInfo");

let activeChatRef = null;
let chatActive = false;
let lastSent = 0;
const cooldown = 5000;

// ----------------- Brainrots laden -----------------
const brainrotRef = ref(db,"brainrots");
onValue(brainrotRef, snapshot=>{
  const data = snapshot.val();
  brainrotContainer.innerHTML="";
  if(!data) brainrotContainer.innerHTML="<p>ğŸ˜¢ Keine Brainrots verfÃ¼gbar</p>";
  else {
    Object.entries(data).forEach(([key, item])=>{
      const card = document.createElement("div");
      card.className = "brainrot-card";
      card.innerHTML = `
        <h3>${item.name}</h3>
        <p>ğŸ’ ${item.rarity}</p>
        <p>ğŸ’° ${item.incomePerSecond} / Sekunde</p>
        <p>ğŸ“¦ Lager: ${item.stock}</p>
        <button id="tradeBtn-${key}">Traden</button>
      `;
      brainrotContainer.appendChild(card);

      // Button Event
      document.getElementById(`tradeBtn-${key}`).addEventListener("click", ()=>{
        const robloxName = prompt("Dein Roblox-Name:");
        if(!robloxName) return alert("âš ï¸ Bitte Roblox-Name eingeben!");
        const offer = prompt("Was willst du fÃ¼r den Brainrot geben?");
        if(!offer) return alert("âš ï¸ Bitte Angebot eingeben!");

        // Trade in Firebase speichern
        const tradeRef = push(ref(db,"trades"));
        set(tradeRef,{
          userId,
          robloxName,
          offer,
          brainrotId: key,
          brainrotName: item.name,
          accepted:false,
          time:Date.now()
        });
        tradeIdDisplay.textContent = "ğŸ†” Deine Trade-ID: " + tradeRef.key;
        alert("âœ… Trade-Anfrage gesendet! Warte auf Admin-Freigabe.");
      });
    });
  }
});

// ----------------- Chat-Login -----------------
loginChatBtn.addEventListener("click", ()=>{
  const enteredId = tradeIdInput.value.trim();
  if(!enteredId){ alert("âš ï¸ Bitte Trade-ID eingeben"); return; }
  const tradeRef = ref(db,"trades/"+enteredId);

  onValue(tradeRef, snapshot=>{
    const trade = snapshot.val();
    if(!trade){ alert("âš ï¸ Trade-ID ungÃ¼ltig"); return; }
    if(trade.userId !== userId){ alert("âš ï¸ Diese Trade-ID gehÃ¶rt nicht dir"); return; }
    if(!trade.accepted){ chatBox.textContent = "â³ Admin hat die Anfrage noch nicht angenommen."; chatActive=false; return; }

    activeChatRef = ref(db,"chats/"+enteredId);
    chatBox.textContent = "";
    chatActive = true;
    chatInfo.textContent = "ğŸ’¬ Chat aktiviert!";

    // Live-Chat
    onValue(activeChatRef, snap=>{
      const messages = snap.val();
      chatBox.innerHTML="";
      if(!messages){ chatBox.textContent="ğŸ’¬ Noch keine Nachrichten"; return; }
      Object.values(messages).sort((a,b)=>a.time-b.time).forEach(msg=>{
        const div = document.createElement("div");
        div.className="message";
        div.textContent = `${msg.user}: ${msg.text}`;
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  }, {onlyOnce:false});
});

// ----------------- Chat senden -----------------
sendChatBtn.addEventListener("click", async()=>{
  if(!chatActive){ alert("âš ï¸ Chat noch nicht freigeschaltet!"); return; }
  const text = chatInput.value.trim();
  if(!text) return;
  const now = Date.now();
  if(now - lastSent < cooldown) return alert("âš ï¸ Warte ein paar Sekunden!");
  lastSent = now;
  const newRef = push(activeChatRef);
  await set(newRef,{user:"User", text, time:now});
  chatInput.value="";
});
</script>
</body>
</html>